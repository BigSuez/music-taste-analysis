<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Read JSON File and Visualize</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100vh;
            background-color: #f9f9f9;
        }
        #chart {
            width: 80%;
            height: 60%;
        }
        #year-slider-container {
            width: 80%;
            display: flex;
            align-items: center;
        }
        #year-slider-label {
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div id="chart"></div>
    <div id="year-slider-container">
        <label id="year-slider-label" for="year-slider">Select Years:</label>
        <input type="range" id="year-slider" min="1970" max="2023" step="1" value="1970">
    </div>

    <script>
        // Make an AJAX request to fetch the JSON file
        var url = "https://raw.githubusercontent.com/BigSuez/project-3/main/Extraction/Outputs/genre_stats.json";
        fetch(url)
            .then(response => response.json())
            .then(data => {
                var dates = [];
                var genres = [];
                var genreCounts = [];

                // Process the initial data
                dates = data.map(obj => obj.date);
                genres = Object.keys(data[0].genres);
                genreCounts = genres.map(genre => data.map(obj => obj.genres[genre]));

                var colors = [
                    'rgb(31, 119, 180)', // blue
                    'rgb(255, 127, 14)', // orange
                    'rgb(44, 160, 44)',  // green
                    'rgb(214, 39, 40)',  // red
                    'rgb(148, 103, 189)', // purple
                    'rgb(140, 86, 75)',  // brown
                    'rgb(227, 119, 194)', // pink
                    'rgb(127, 127, 127)'  // gray
                ];

                var traces = genres.map((genre, index) => ({
                    x: dates,
                    y: genreCounts[index],
                    name: genre,
                    type: 'scatter',
                    mode: 'markers',
                    marker: {
                        size: 8,
                        symbol: 'circle',
                        opacity: 0.8,
                        color: colors[index % colors.length],
                        line: {
                            color: 'rgb(8, 48, 107)',
                            width: 1
                        }
                    }
                }));

                var layout = {
                    title: 'Genre Counts Over Time',
                    xaxis: {
                        title: 'Date'
                    },
                    yaxis: {
                        title: 'Genre Count'
                    }
                };

                // Create the initial chart
                Plotly.newPlot('chart', traces, layout);

                // Handle changes to the year slider
                var yearSlider = document.getElementById('year-slider');
                yearSlider.addEventListener('input', function () {
                    var selectedYear = Number(this.value);
                    updateChart(selectedYear);
                });

                // Function to update the chart based on the selected year
                function updateChart(selectedYear) {
                    var filteredData = data.filter(obj => {
                        var year = Number(obj.date.substring(0, 4));
                        return year <= selectedYear;
                    });

                    var filteredDates = filteredData.map(obj => obj.date);
                    var filteredGenreCounts = genres.map(genre => filteredData.map(obj => obj.genres[genre]));

                    // Update the chart data
                    for (var i = 0; i < traces.length; i++) {
                        traces[i].x = filteredDates;
                        traces[i].y = filteredGenreCounts[i];
                    }

                    // Replot the chart with the updated data
                    Plotly.react('chart', traces, layout);
                }
            })
            .catch(error => {
                console.error('Failed to fetch JSON data', error);
            });
    </script>
</body>
</html>